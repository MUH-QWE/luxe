<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Login - LUXE Fashion</title>
    <link rel="stylesheet" href="css/Navbar.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/Auth.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
</head>

<body data-page="login">

    <header id="main-header">
        <div class="container">
            <div class="logo" data-link="index.html">
                <i class="fas fa-crown"></i><span>LUXE</span>
            </div>
            <nav id="navbar-links">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="Products.html">Products</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <div class="cart-icon" data-link="Cart.html">
                    <i class="fas fa-shopping-bag"></i><span class="cart-count">0</span>
                </div>
            </div>
        </div>
    </header>

    <div id="auth-page">
        <div class="auth-container">
            <div class="auth-form">
                <div class="auth-header">
                    <h1>Welcome Back</h1>
                    <p>Please sign in to your account</p>
                </div>

                <form id="login-form">
                    <div class="form-group">
                        <label><i class="far fa-envelope"></i> Email Address</label>
                        <input type="email" id="email" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-lock"></i> Password</label>
                        <input type="password" id="password" required placeholder="Enter your password">
                    </div>
                    <button type="submit" class="btn-primary" style="width:100%;">Sign In</button>
                </form>

                <form id="register-form" style="display:none;">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="reg-name" required>
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="reg-email" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="reg-password" required>
                    </div>
                    <button type="submit" class="btn-primary" style="width:100%;">Create Account</button>
                </form>

                <div class="auth-footer" style="text-align:center; margin-top:20px;">
                    <p id="toggle-auth">New user? <a href="#" id="show-register">Create an account</a></p>
                    <p id="toggle-login" style="display:none;">Already registered? <a href="#" id="show-login">Login here</a></p>
                </div>

                <div id="auth-error-message" style="color:red; margin-top:10px; font-weight:bold;"></div>
                <div id="auth-success-message" style="color:green; margin-top:10px; font-weight:bold;"></div>
            </div>
        </div>
    </div>

    <footer id="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="logo"><i class="fas fa-crown"></i><span>LUXE</span></div>
                    <p>Premium fashion for the modern individual. Quality, style, and elegance in every piece.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="Products.html">Shop</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="js/ALL.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            LuxeApp.updateCartUI?.();

            const showRegister = document.getElementById('show-register');
            const showLogin = document.getElementById('show-login');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const errorDiv = document.getElementById('auth-error-message');
            const successDiv = document.getElementById('auth-success-message');

            function clearError() { errorDiv.textContent = ''; }
            function showError(msg) { errorDiv.textContent = msg; setTimeout(clearError, 5000); }

            function clearSuccess() { successDiv.textContent = ''; }
            function showSuccess(msg) { successDiv.textContent = msg; setTimeout(clearSuccess, 5000); }

            showRegister.onclick = (e) => {
                e.preventDefault();
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                document.querySelector('.auth-header h1').textContent = 'Create Account';
                document.querySelector('.auth-header p').textContent = 'Join us today';
                document.getElementById('toggle-auth').style.display = 'none';
                document.getElementById('toggle-login').style.display = 'block';
                clearError();
                clearSuccess();
            };

            showLogin.onclick = (e) => {
                e.preventDefault();
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                document.querySelector('.auth-header h1').textContent = 'Welcome Back';
                document.querySelector('.auth-header p').textContent = 'Please sign in to your account';
                document.getElementById('toggle-auth').style.display = 'block';
                document.getElementById('toggle-login').style.display = 'none';
                clearError();
                clearSuccess();
            };

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value.trim();
                if (!email || !password) { showError('Enter both email and password.'); return; }

                LuxeApp.login?.(email, password)
                    .then(user => {
                        if (!user) { showError('Invalid credentials.'); return; }
                        LuxeApp.state.user = user;
                        localStorage.setItem(LuxeApp.config.userKey, JSON.stringify(user));
                        if (user.role === 'admin') window.location.href = 'App.html';
                        else window.location.href = 'index.html';
                    })
                    .catch(err => { console.error(err); showError('Login failed.'); });
            });

            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('reg-name').value.trim();
                const email = document.getElementById('reg-email').value.trim();
                const password = document.getElementById('reg-password').value.trim();
                if (!name || !email || !password) { showError('Please fill all fields.'); return; }

                LuxeApp.register?.({ name, email, password })
                    .then(user => {
                        if (!user) { showError('Registration failed.'); return; }
                        showSuccess('Account created successfully! Please login.');
                        showLogin.click(); 
                    })
                    .catch(err => { console.error(err); showError('Registration failed.'); });
            });

            document.querySelectorAll('[data-link]').forEach(el => {
                el.addEventListener('click', () => {
                    const url = el.getAttribute('data-link');
                    if (url) window.location.href = url;
                });
            });
        });
    </script>
</body>

</html>
